{% extends "core/base.html" %}
{% block content %}
    <h1 class="text-xl font-bold mb-4">üìä Stock Forecast Dashboard</h1>
    <form method="get" class="mb-6 flex gap-4">
        <select name="product_id" class="border rounded px-2 py-1">
            <option value="">All Products</option>
            {% for product in products %}
                <option value="{{ product.id }}"
                        {% if request.GET.product_id == product.id|stringformat:"s" %}selected{% endif %}>
                    {{ product.name }}
                </option>
            {% endfor %}
        </select>
        <select name="warehouse_id" class="border rounded px-2 py-1">
            <option value="">All Warehouses</option>
            {% for wh in warehouses %}
                <option value="{{ wh.id }}"
                        {% if request.GET.warehouse_id == wh.id|stringformat:"s" %}selected{% endif %}>
                    {{ wh.name }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded">Filter</button>
    </form>
    <table class="table-auto w-full border">
        <thead class="bg-gray-200">
            <tr>
                <th>Product</th>
                <th>Warehouse</th>
                <th>Current Stock</th>
                <th>Reorder Level</th>
                <th>Predicted Sales (Next 30 days)</th>
                <th>Projected Stock</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for row in forecast_data %}
                <tr onclick="window.location='{% url 'forecast:forecast_chart' row.product.id row.warehouse.id %}'"
                    class="cursor-pointer hover:bg-blue-50 {% if row.will_be_low %}bg-red-100{% else %}bg-green-50{% endif %}">
                    <td>{{ row.product.name }}</td>
                    <td>{{ row.warehouse.name }}</td>
                    <td>{{ row.current_stock }}</td>
                    <td>{{ row.reorder_level }}</td>
                    <td>{{ row.predicted_sales|floatformat:2 }}</td>
                    <td>{{ row.projected_stock|floatformat:2 }}</td>
                    <td>
                        {% if row.will_be_low %}
                            ‚ö†Ô∏è Low Stock Soon
                        {% else %}
                            ‚úÖ Stable
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="7" class="text-center py-4">No forecast data available.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
